<polymer-element name="neuron-base" attributes="name defaultSize initialValue state">
	<template>
	</template>

	<script>
		Polymer({

			defaultSize: 1,
			initialValue: 0,

			ready: function(){
				this.neuronValues = [];
				this.elems = [];

				for(var i = 0; i< this.defaultSize; i++){
					this.neuronValues.push(this.initialValue);
					this.elems.push(1);
				}

				this.neuron = null;
				this.state = 'disconnected';

				this.autosend = false;
				this.frequency = 20;
			},

			isConnected: function(){
				return this.neuron ? true : false;
			},

			setNeuron: function(dnId, neuron){
				this.neuron = neuron;

				if(!neuron) return ;

				neuron.autosend = this.autosend;
				neuron.frequency = this.frequency;

				this.state = 'connected';

				neuron.on('close', this.onClose.bind(this));


				if(this.defaultSize !== neuron.size){
					while(this.neuronValues.length > neuron.size) this.neuronValues.pop();
					while(this.elems.length > neuron.size) this.elems.pop();

					while(this.neuronValues.length < neuron.size) {
						this.neuronValues.push(this.initialValue);
						this.elems.push(1);
					}
				}

				if(neuron.type === 'output'){
					this.sendAll();
				}else if(neuron.type === 'input'){
					neuron.on('value', this.onValue.bind(this));
				}
			},

			sendAll: function(){
				this.neuron.writeAll(this.neuronValues);
			},

			send: function(neuronId, val){
				this.neuronValues[neuronId] = val;
				this.neuron.writeAll(this.neuronValues);
			},

			sendEvent: function(neuronId, period){
				var that = this;

				this.neuronValues[neuronId] = 1;
				this.neuron.writeAll(this.neuronValues);

				setTimeout(function(){
					that.neuronValues[neuronId] = 0;
					that.neuron.writeAll(that.neuronValues);
				}, period ||Â 500);
			},

			onValue: function(value){
				for(var i=0;i<value.length; i++){
					this.neuronValues[i] = value[i];
				}
				this.fire('value', this.neuronValues);
			},

			onClose: function(){
				console.log(this.neuron.name +" closed !");
				this.neuron = null;
				this.state = 'disconnected';
			}
		});

	</script>
</polymer-element>
